# 日本語タイピング練習（Raycast拡張）— 要件定義 v0.1

- 版: v0.1（初回ドラフト）
- 対象: Raycast Extension
- 目的: 日本語の単語/短文を題材に、ローマ字入力を中心としたタイピング練習を高速に行えるコマンドを提供する。

## 1. 背景 / 目的
- Raycast上で素早く起動し、1〜3分程度の短時間で日本語のタイピング練習ができる体験を提供する。
- 学習履歴を手元に保持し、速度と正確性の向上を可視化する。
- プライバシーを重視し、データをローカルに限定（MVP）。

## 2. 用語定義
- 出題テキスト: 練習対象の日本語テキスト（単語/短文）。
- 読み（かな）: 出題テキストの読み。ローマ字変換の基準に用いる。
- ローマ字規則: 「shi/si」「n/nn」「ltsu/xtu」など許容する表記ゆれの規則群。
- セッション: 練習を開始して終了するまでの一連の操作。

## 3. ペルソナ / 想定ユーザー
- 日本語配列ではなくローマ字入力で練習したいユーザー。
- 空き時間に短時間（30秒〜3分）で練習したいRaycastユーザー。
- 日本語特有（拗音/促音/長音/撥音/句読点）の入力ルールを正しく身につけたいユーザー。

## 4. スコープ
- MVP: オフライン/ローカルのみで完結するタイピング練習（単語/短文、時間指定、結果表示、履歴保存）。
- 非スコープ（MVP外）: クラウド同期、オンラインランキング、外部辞書の自動取得、音声出力。

## 5. 前提 / 制約
- プラットフォーム: Raycast 最新安定版、macOS 13+（Intel/Apple Silicon）。
- UI部品: Raycastの `List` / `Detail` / `Form` / `ActionPanel` 等を活用。
- 入力: ローマ字入力を第一クラス市民とする（IME ONの影響は最小化、MVPではIME OFFを推奨表示）。
- データ保管: Raycastのローカルストレージ（LocalStorage/Cache）に限定。
- オフライン: 前提。ネットワーク不要。

## 6. 機能要件（MVP）
- FR-1 コマンド起動
  - Raycastのコマンド「日本語タイピング練習」を提供。ショートカット割当可。
- FR-2 練習モード
  - 時間制: 30秒/1分/3分（Preferencesで既定時間を設定）。
  - 出題: 内蔵の単語/短文コーパスからランダム出題（重複抑制）。
- FR-3 表示
  - 上段: 出題テキスト（日本語）と読み（かな、任意表示）。
  - 中段: 進捗表示（入力済み/未入力の可視化、誤タイプの強調）。
  - 下段: 残り時間、正確性(%), 速度（CPM/WPM）。
- FR-4 入力判定（ローマ字）
  - 許容表記ゆれ: 例）si/shi、ti/chi、tu/tsu、fu/hu、nn/n、ltsu/xtu など。
  - 拗音/促音/長音/撥音/句読点/記号のルールを内蔵テーブルで判定。
  - 大文字/小文字は区別しない。
- FR-5 採点
  - 速度: CPM（characters per minute）とWPM（5打=1語換算）。
  - 正確性: 正打数/総タイプ数。
  - ミス数: バックスペースを伴う誤タイプ、スキップ回数を記録。
- FR-6 セッション制御
  - 開始/一時停止/再開/終了。ショートカット: Start ⏎ / Pause ⌘P / Restart ⌘R。
  - スキップ: 現在の出題をスキップ（ペナルティは設定でON/OFF）。
- FR-7 結果表示
  - セッション結果（CPM/WPM/正確性/ミス/最長連続正打）を表示、HUD/Toastでサマリ表示。
- FR-8 履歴管理（ローカル）
  - 直近N件（既定: 50）をローカル保存。履歴一覧・平均・ベストを可視化。
- FR-9 設定（Preferences）
  - 既定練習時間、難易度（初級/中級/上級）、ローマ字規則プロファイル、読みの表示ON/OFF、履歴保持数。
- FR-10 アクセシビリティ
  - キーボードのみで全操作可能。フォーカス可視。最低コントラスト遵守。

## 7. 非機能要件（NFR）
- NFR-1 レイテンシ: 入力から描画更新まで16ms目標、50msを超えない。
- NFR-2 安定性: 連続30分の使用でメモリリーク・クラッシュなし。
- NFR-3 プライバシー: データはローカルのみ。外部送信なし（MVP）。
- NFR-4 可搬性: macOS 13+/Apple Silicon/Intelで動作。
- NFR-5 国際化: UIは日本語既定。英語化は将来対応。

## 8. UX/画面仕様（概要）
- 画面遷移: 起動 → 設定/説明 → 練習 → 結果 → 履歴。
- コマンド
  - Main: 日本語タイピング練習（練習開始/再開）。
  - History: 履歴と統計を表示（将来、別コマンドに分離可）。
- ショートカット
  - Start ⏎ / Pause ⌘P / Restart ⌘R / Skip ⌘→ / 終了 ⌘W。
- 進捗表現
  - 入力済み: 強調色、未入力: 通常色、誤タイプ: 下線/背景色。

## 9. データ仕様
- 出題データ（内蔵JSON; 最小例）
```json
{
  "id": "ex-0001",
  "text": "新幹線",
  "reading": "しんかんせん",
  "difficulty": 2
}
```
- 履歴保存（ローカル; 最小例）
```json
{
  "id": "sess-2025-11-06T23:59:00Z",
  "durationSec": 60,
  "cpm": 320,
  "wpm": 64,
  "accuracy": 0.94,
  "mistakes": 11,
  "streakMax": 27,
  "skips": 1,
  "finishedAt": "2025-11-06T23:59:59Z",
  "version": "0.1.0"
}
```
- ローマ字規則（例）
  - し: shi / si
  - ち: chi / ti
  - つ: tsu / tu
  - ふ: fu / hu
  - しゃ: sha / sya
  - ちゃ: cha / tya
  - っ + 子音: ltsu/xtu + 子音重ね
  - ん: n / nn（次が母音/や行のときは nn 推奨）
  - 長音: ー は直前母音の伸長（o/ou, u/uu 等、プロファイルで統一）

## 10. 設定（Preferences）
- 練習時間（秒）: 30 / 60 / 180（既定: 60）
- 難易度: 初級/中級/上級（出題セットを切替）
- ローマ字プロファイル: JIS推奨/ヘボン/自由度高（表記ゆれ許容幅）
- 読みの表示: ON/OFF（初級ON、他OFF）
- 履歴保持件数: 10〜500（既定: 50）
- スキップペナルティ: ON/OFF（ON=正確性に-1%加点など）

## 11. 計測/テレメトリ
- MVPでは外部送信なし。
- ローカル統計のみ（平均CPM/WPM、直近推移、ベスト）。

## 12. エラーハンドリング
- IMEがONの場合の注意表示（MVPではOFF推奨トースト）。
- 不正キー/未定義ローマ字は即時に誤タイプ扱い・視覚強調。
- ストレージ上限到達時は古い順にローテーション。

## 13. 受入基準（サンプル）
- AC-1 起動/開始
  - Given Raycast上でコマンドを起動
  - When ⏎で開始
  - Then 出題が表示され、タイマがカウントダウンを開始する
- AC-2 入力判定（表記ゆれ）
  - Given 出題「しゃ」
  - When "sha" または "sya" と入力
  - Then 正打として進捗が更新される
- AC-3 結果表示と保存
  - Given 練習終了
  - When 結果画面が表示
  - Then CPM/WPM/正確性/ミス/最長連続が表示され、履歴に追加される

## 14. テスト方針
- 単体: ローマ字変換・表記ゆれマッパー、採点計算、時間制御。
- 受入: ACに基づく手動テスト（主要フロー）。
- スナップショット: UIの主要状態（開始/進行/終了）。

## 15. リリース/運用
- バージョニング: SemVer（0.x期間は破壊的変更あり得る）。
- CHANGELOG管理、Raycast Store用メタデータ整備（名称/説明/アイコン/カテゴリ）。

## 16. 将来拡張（Backlog）
- 外部辞書のインポート（JSON/CSV）。
- レッスン/段位モード、弱点克服（苦手音素の出題強化）。
- 英数/記号強化、プログラミング記号モード。
- オンラインランキング（オプトイン、匿名ID）。
- テーマ切替、音（タイプ音/効果音）。

## 17. オープンクエスチョン
- 出題コーパスの初期サイズ/ライセンス方針。
- ローマ字規則の既定プロファイル詳細（JIS/ヘボン混在の扱い）。
- かな直接入力モードの必要性・優先度。

---
（備考）本書は初回ドラフトです。実装中にRaycastの制約で変更が必要な場合は、章 5 の前提/制約と整合するよう最小修正で更新します。
